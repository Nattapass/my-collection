<div class="rounded-md border border-gray-200 bg-white p-4">
  <div class="d-flex justify-between align-items-center">
    <div>
      <h3 class="text-lg font-semibold text-gray-900">Book Reviews</h3>
      <p class="mt-2 text-sm text-gray-600">This section can show book review data.</p>
    </div>
    <div class="d-flex gap-2">
      <button
        type="button"
        class="rounded-md border border-gray-300 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100"
        (click)="openFilter()"
      >
        Filter
      </button>
      <button
        type="button"
        class="rounded-md bg-gray-900 px-3 py-2 text-sm font-medium text-white hover:bg-gray-800"
        [disabled]="isLoading()"
        (click)="refresh()"
      >
        Refresh
      </button>
    </div>
  </div>

  <div class="mt-4 d-flex justify-between align-items-center gap-2">
    <div class="flex-grow-1">
      <input
        type="text"
        class="form-control"
        placeholder="Search by name..."
        [ngModel]="searchTerm()"
        (ngModelChange)="onSearch($event)"
      />
    </div>
    <button
      type="button"
      class="rounded-md bg-gray-900 px-3 py-2 text-sm font-medium text-white hover:bg-gray-800"
      (click)="onSearch(searchTerm())"
    >
      Search
    </button>
  </div>

  <div class="mt-4 overflow-x-auto">
    <table class="min-w-full border border-gray-200 text-left text-sm text-gray-700">
      <thead class="bg-gray-50 text-xs font-semibold uppercase text-gray-600">
        <tr>
          <th class="px-3 py-2">รูป</th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('name')">
              ชื่อ
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'name') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('type')">
              ประเภท
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'type') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('license')">
              License
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'license') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('total')">
              จำนวนเล่ม
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'total') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('story')">
              เนื้อเรื่อง
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'story') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('character')">
              ตัวละคร
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'character') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('illustration')">
              ภาพ
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'illustration') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('storytelling')">
              การเล่าเรื่อง
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'storytelling') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">
            <button type="button" class="text-xs font-semibold uppercase text-gray-600 d-inline-flex align-items-center gap-1" (click)="setSort('score')">
              สรุปคะแนน
              <span class="text-[10px] text-gray-400">↕</span>
              @if (sortKey() === 'score') { <span>{{ sortDir() === 'asc' ? '▲' : '▼' }}</span> }
            </button>
          </th>
          <th class="px-3 py-2">ความเห็น</th>
        </tr>
      </thead>
      <tbody>
        @if (isLoading()) {
          @for (item of [].constructor(15); let idx = $index; track idx) {
            <tr class="border-t border-gray-200">
              <td class="px-3 py-2">
                <div class="h-16 w-16 animate-pulse rounded bg-gray-200"></div>
              </td>
              <td class="px-3 py-2"><div class="h-4 w-32 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-20 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-20 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-10 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-16 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-16 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-16 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-20 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-10 animate-pulse rounded bg-gray-200"></div></td>
              <td class="px-3 py-2"><div class="h-4 w-48 animate-pulse rounded bg-gray-200"></div></td>
            </tr>
          }
        } @else {
          @for (item of sortedBooks() | slice: (page - 1) * pageSize : page * pageSize; track item.name) {
        <tr class="border-t border-gray-200 align-top">
          <td class="px-3 py-2">
            <div class="h-24 w-24 overflow-hidden rounded bg-gray-100">
              <img
                [src]="item.image"
                alt="Review Book"
                class="h-full w-full object-cover"
              />
            </div>
          </td>
          <td class="px-3 py-2 font-medium text-gray-900">{{ item.name }}</td>
          <td class="px-3 py-2">{{ item.type }}</td>
          <td class="px-3 py-2">{{ item.license }}</td>
          <td class="px-3 py-2">{{ item.total }}</td>
          <td class="px-3 py-2">{{ item.story }}</td>
          <td class="px-3 py-2">{{ item.character }}</td>
          <td class="px-3 py-2">{{ item.illustration }}</td>
          <td class="px-3 py-2">{{ item.storytelling }}</td>
          <td class="px-3 py-2">{{ item.score }}</td>
          <td class="px-3 py-2 whitespace-pre-line">{{ item.comment }}</td>
        </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <ngb-pagination
    class="mt-4 d-flex justify-content-end"
    [collectionSize]="sortedBooks().length"
    [(page)]="page"
    [maxSize]="5"
    [rotate]="true"
    [ellipses]="false"
    [boundaryLinks]="true"
    [pageSize]="pageSize"
  />
</div>

@if (isFilterOpen()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
    <div class="w-full max-w-md rounded-lg bg-white p-4 shadow-lg">
      <h4 class="text-lg font-semibold text-gray-900">Filter</h4>
      <div class="mt-4 space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700">ประเภท</label>
          <select
            class="form-select mt-1"
            [ngModel]="pendingType()"
            (ngModelChange)="pendingType.set($event)"
          >
            <option value="">ทั้งหมด</option>
            @for (item of types(); track item) {
              <option [value]="item">{{ item }}</option>
            }
          </select>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">ลิขสิทธิ์</label>
          <select
            class="form-select mt-1"
            [ngModel]="pendingLicense()"
            (ngModelChange)="pendingLicense.set($event)"
          >
            <option value="">ทั้งหมด</option>
            @for (item of licenses(); track item) {
              <option [value]="item">{{ item }}</option>
            }
          </select>
        </div>
      </div>
      <div class="mt-6 d-flex justify-between">
        <button
          type="button"
          class="rounded-md border border-gray-300 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100"
          (click)="clearFilter(); closeFilter()"
        >
          ล้างค่า
        </button>
        <div class="d-flex gap-2">
          <button
            type="button"
            class="rounded-md border border-gray-300 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100"
            (click)="closeFilter()"
          >
            ยกเลิก
          </button>
          <button
            type="button"
            class="rounded-md bg-gray-900 px-3 py-2 text-sm font-medium text-white hover:bg-gray-800"
            (click)="applyFilter()"
          >
            ตกลง
          </button>
        </div>
      </div>
    </div>
  </div>
}
